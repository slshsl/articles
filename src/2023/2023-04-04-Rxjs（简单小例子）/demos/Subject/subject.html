<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		Logged in:<span id="logged-in"></span>
		<div>
			<button id="login">Login</button>
			<button id="logout">Logout</button>
		</div>
		<button id="print-state">Print</button>
		<script src="./rxjs.js"></script>
		<script>
			const { BehaviorSubject, fromEvent, Subject, withLatestFrom } = rxjs;

			const loggedInSpan = document.querySelector('span#logged-in');
			const loginButton = document.querySelector('button#login');
			const logoutButton = document.querySelector('button#logout');
			const printStateButton = document.querySelector('button#print-state');
			const isLoggedIn$ = new Subject();
			fromEvent(loginButton, 'click').subscribe(() => isLoggedIn$.next(true));
			fromEvent(logoutButton, 'click').subscribe(() => isLoggedIn$.next(false));

			isLoggedIn$.subscribe(
				(isLoggedIn) => (loggedInSpan.innerText = isLoggedIn.toString())
			);

			isLoggedIn$.subscribe((isLoggedIn) => {
				logoutButton.style.display = isLoggedIn ? 'block' : 'none';
				loginButton.style.display = !isLoggedIn ? 'block' : 'none';
			});

			// 获取Subject最新的值
			fromEvent(printStateButton, 'click')
				.pipe(withLatestFrom(isLoggedIn$))
				.subscribe(([event, isLoggedIn]) => console.log(isLoggedIn));
		</script>
	</body>
</html>
