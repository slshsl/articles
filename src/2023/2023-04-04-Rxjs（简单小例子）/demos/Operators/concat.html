<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<script src="./rxjs.js"></script>
		<script>
			const { Observable, concat, of, delay } = rxjs;

			// 发出 1,2,3
			const sourceOne = of(1, 2, 3).pipe(delay(3000));
			// 发出 4,5,6
			const sourceTwo = of(4, 5, 6).pipe(delay(3000));

			concat(sourceOne, sourceTwo).subscribe((val) =>
				console.log('Concat', val)
			);

			// 自己实现的concat
			const myConcat = function (...args) {
				return new Observable((subscriber) => {
					const iterator = args[Symbol.iterator]();
					let subscription;
					const test = (iterator) => {
						item = iterator.next();
						if (!item.done) {
							subscription = item.value.subscribe({
								next: (val) => {
									subscriber.next(val);
								},
								complete: () => {
									test(iterator);
								},
								error: (err) => {
									subscriber.error(err);
								}
							});
						} else {
							subscriber.complete();
						}
					};
					test(iterator);
					return () => {
						subscription && subscription.unsubscribe();
					};
				});
			};

			const subscription = myConcat(sourceOne, sourceTwo).subscribe((val) =>
				console.log('MyConcat', val)
			);
			setTimeout(() => {
				subscription.unsubscribe();
			}, 3000);
		</script>
	</body>
</html>
